---
layout: post
section-type: post
title: crawling - P2. 고급 스크레이핑 _ chap 11. 이미지 처리와 텍스트 인식
category: python
tags: [ 'python' ]
---

구글의 자율주행 자동차부터 위조지폐 인식하는 자판기까지, 컴퓨터에 눈을 다는 방대한 작업은 우리에게 큰 영향을 미치는 분야입니다. 이번 챕터에서는 이 분야의 작은 일부인 텍스트 인식에 집중합니다. 그중에서도, 온라인에서 가져온 텍스트 기반 이미지를 다양한 파이썬 라이브러리로 인식하고 사용하는 방법에 대해 다룹니다.  

텍스트 대신 이미지를 쓰는 건 봇이 텍스트를 읽는 것을 막기위해 사용하는 방법 중 하나입니다. 연락처에서 이메일 주소나 전체부분을 이미지 처리된 경우들이 있습니다. 정교하게 처리하면 사람조차도 이미지인지 텍스트인지 구분하기 어렵고, 봇은 그런 이미지 때문에 스팸을 뿌려대는 사람들로부터 이메일 주소를 보호할 수 있습니다.  

자동 가입 방지 문자(CAPTCHA) 역시 사용자가 보안 이미지를 읽을 수 있지만 대부분의 못은 읽지 못한다는 점을 이용합니다.  

하지만 웹 스크레이퍼가 이미지를 텍스트로 인식해야 하는 분야는 CAPTCHA만이 아닙니다. 최근에는 문서를 그냥 스캔해서 업로드 하는 경우가 많습니다. 이런 문서는 인터넷이라는 관점에서 보기엔 접근이 불가능한 것이나 마찬가지입니다. 이미지를 텍스트로 인식하는 기능이 없다면 이들 문서에 접근할 수 있는 방법은 사람이 손으로 타이핑하는 것 뿐입니다.  

이미지를 텍스트로 바꾸는 작업을 **광학 문자 인식(OCR)** 이라고 합니다. OCR 기능이 있는 주요 라이브러리는 그리 많지 않지만, 이들을 지원하거나 이들을 기반으로 만들어진 라이브러리는 여러가지입니다.

## 11.1 라이브러리 개관

파이썬은 이미지 처리와 읽기, 이미지 기반 머신 러닝, 심지어 이미지 생성에도 매우 뛰어난 언어입니다. 이미지 처리에 사용할 수 있는 라이브러리는 다양하지만, 이번 챕터에서는 필로(pillow)와 테서랙트(tesseract) 두 가지만 사용합니다.

### 11.1.1 필로

필로는 가장 많은 기능을 갖춘 이미지 처리 라이브러리는 아니지만, 파이썬으로 포토샵 같은 것을 만들거나 연구할 목적이 아닌 이상 필로정도면 충분합니다. 문서화도 잘 되어 있고, 사용하기도 쉽습니다.  

설치는 pip를 통해 하면 됩니다.

```
pip install pillow
```

필로는 파이썬 2.x용 파이썬 이미지 라이브러리인 PIL에서 갈려져 나와 파이썬 3.x 지원을 추가했습니다. PIL과 마찬가지로, 필로도 쉽게 이미지를 불러오고 조작하고, 다양한 필터와 마스크, 픽셀 단위 변형도 가능합니다.


```python
from PIL import Image, ImageFilter

kitten = Image.open("kitten.jpg")
blurryKitten = kitten.filter(ImageFilter.GaussianBlur)
blurryKitten.save("kitten_blurred.jpg")
blurryKitten.show()
```

위 코드는 kitten.jpg 이미지에 블러 효과를 추가해 기본 이미지 뷰어에서 열고, 동시에 kitten_blurred.jpg 라는 이름으로 저장합니다.  

필로는 이런 단순한 기능 외에도 많은 기능이 있습니다. 자세한 정보는 [문서](http://pillow.readthedocs.io/en/4.2.x/){:target="`_`blank"}를 참고합니다.

### 11.1.2 테서랙트

테서랙트는 OCR 라이브러리입니다. 테서랙트는 OCR과 머신 런닝으로 유명한 구글의 투자를 받고 있는데, 가장 정확한 최고의 오픈 소스 OCR 시스템으로 널리 인정받고 있습니다.  

테서랙트는 정확할 뿐 아니라 굉장히 유연합니다. 테서랙트는 폰트가 비교적 일관적이기만 하면, 숫자에 제한 없이 그 폰트를 인식하도록 훈련할 수 있으며, 유니코드 문자도 인식하도록 확장이 가능합니다.  

테서랙트는 import 문으로 불러오는 라이브러리가 아니라 파이썬으로 작성된 CLT(command line tool)입니다. 설치를 마치면 반드시 파이썬 명령행 외부에서 tesseract 명령어로 실행해야 합니다.

#### 테서랙트 설치

설치는 홈브류로 설치하면 됩니다.

```
brew install tesseract
```

테서랙트를 훈련시키는 것 같은 일부 기능은 데이터 파일(.traineddata 확장자)이 필요하며, 데이터 파일은 테서랙트 설치 위치 아래 tessdata 디렉터리에 위치해야 합니다.
> 데이터 파일을 따로 내려받지 않았다면 https://github.com/tesseract-ocr/tessdata 에서 직접 내려 받아야 합니다.

환경에 따라 테서랙트 설치 위치를 지정하는 환경 변수 `$TESSDATA_PREFIX`를 설정해야 할 수도 있습니다. 필요하다면 대부분의 리눅스와 맥 OS X에서는 아래 명령을 이용하면 됩니다.

```
$export TESSDATA_PREFIX=/usr/local/share/
```

`/usr/local/share/`는 테서랙트의 기본 설치 위치입니다.

### 11.1.3 넘파이

단순한 OCR에서는 필요하지 않지만, 테서랙트가 사용할 다른 문자나 폰트도 인식하도록 훈련하려면 넘파이(NumPy)가 필요합니다. 넘파이는 선형 대수학이나 기타 대규모 수학 애플리케이션에 사용하는 매우 강력한 라이브러리입니다. 넘파이는 이미지를 수학적인 거대한 픽셀 배열로 표현하고 조작할 수 있는데, 테서랙트에서 이런 기능을 활용할 수 있습니다. 물론 여기에서는 거기까지 사용하지 않습니다.

넘파이도 pip로 설치하면 됩니다.

```
pip install numpy
```

## 11.2 형식이 일정한 텍스트 처리

### 11.2.1 웹사이트 이미지에서 텍스트 스크레이핑하기

## 11.3 CAPTCHA 읽기와 테서랙트 훈련

### 11.3.1 테서랙트 훈련

## 11.2 CAPTCHA 가져오기와 답 보내기
