---
layout: post
section-type: post
title: HTTP-part1.HTTP 웹의 기초 - chap4. 커넥션 관리
category: http
tags: [ 'http' ]
---

Chap4에서 다루는 내용

- HTTP는 어떻게 TCP 커넥션을 사용하는가
- TCP 커넥션의 지연, 병목, 막힘
- 병렬 커넥션, keep-alive 커넥션, 커넥션 파이프라인을 활용한 HTTP의 최적화
- 커넥션 관리를 위해 따라야 할 규칙들

## 4.1 TCP 커넥션

모든 HTTP 통신은 TCP/IP를 통해 이루어진다. 클라이언트 애플리케이션은 서버 어플리케이션으로 TCP/IP 커넥션을 맺을 수 있다. 일단 커넥션이 맺어지면 쌍방의 메시지들은 손실되거나 순서가 바뀌지 않고 안전하게 전달된다.

![]({{ site.url }}/img/post/http/4.1.png)
> 웹브라우저가 TCP 커넥션을 통해서 웹 서버에 요청을 보낸다.

1) 브라우저가 URL 호스트명을 추출한다.
2) 브라우저가 이 호스트 명에 대한 IP 주소를 찾는다.
3) 브라우저가 포트 번호(80)를 얻는다.
4) 브라우저가 202.43.78.3의 80포트로 TCP 커넥션을 생성한다.
5) 브라우저가 서버로 HTTP GET 요청 메시지를 보낸다.
6) 브라우저가 서버에서 온 HTTP 응답 메시지를 읽는다.
7) 브라우저 커넥션을 끊는다.

### 4.1.1 신뢰할 수 있는 데이터 전송 통로인 TCP

TCP는 HTTP에게 신뢰할 만한 통신 방식을 제공한다. TCP 커넥션의 한쪽에 있는 바이트들은 반대쪽으로 순서에 맞게 정확히 전달된다.

![]({{ site.url }}/img/post/http/4.1.png)
> TCP는 충돌 없이 순서에 맞게 HTTP 데이터를 전달한다.

### 4.1.2 TCP 스트림은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다

TCP는 IP 패킷(혹은 IP 데이터그램)이라는 작은 조각을 통해 데이터를 전송한다. HTTP는 '프로토콜 스택(IP, TCP, HTTP)'에서 최상위 계층이다.

![]({{ site.url }}/img/post/http/4.1.2.png)

HTTP가 메시지를 전송할 경우, 현재 연결되어 있는 TCP 커넥션을 통해서 메시지 데이터의 내용을 순서대로 보낸다. TCP는 세그먼트라는 단위로 데이터 스트림을 잘게 나누고, 세그먼트를 IP 패킷이라는 봉투에 담아서 인터넷을 통해 전송한다.  

각 TCP 세그먼트는 하나의 IP 주소에서 다른 IP 주소로 IP 패킷에 담겨 전달된다.  

IP 패킷엔 다음의 것들이 포함된다.
- IP 패킷 헤더 : 발신지와 목적지의 IP 주소, 크기, 기타 플래그를 가진다.  
- TCP 세그먼트 헤더 : TCP 포트번호, TCP 제어 플래그, 데이터의 순서와 무결성을 검사하기 위한 숫자 값을 포함한다.

![]({{ site.url }}/img/post/http/4.1.2_2.png)

### 4.1.3 TCP 커넥션 유지하기

컴퓨터는 항상 여러개의 TCP 커넥션을 가지고 있다. TCP는 포트 번호를 통해 여러 개의 커넥션을 유지한다.

TCP 커넥션은 `발신지 IP주소, 발신지 포트, 수신지 IP주소, 수신지 포트`로 식별한다.
이 4가지 값으로 유일한 커넥션을 생성한다.

### 4.1.4 TCP 소켓 프로그래밍

![]({{ site.url }}/img/post/http/4.1.4.png)
