---
layout: post
section-type: post
title: pyDjango - chap1. 장고 개발의 기본 사항
category: django
tags: [ 'django' ]
---
두 번째 실습이라서 요점만 포스팅합니다.

## 1.1 MTV 개발 방식
MTV
- Model : 테이블을 정의합니다. (`models.py`)
- Template : 사용자가 보게 될 화면의 모습을 정의합니다. (`templates/*.html`)
- View : 애플리케이션의 제어 흐름 및 처리 로직을 정의합니다. (`views.py`)
장점 : 모델, 템플릿, 뷰 모듈 간에 독립성을 유지할 수 있고, 소프트웨어의 중요한 원칙인 느슨한 결합(Loose Coupling) 설계의 원칙에도 부합니다. 또한 디자이너, 응용 개발자, DB 설계자 간에 협업도 쉬워집니다.  
장고에서는 `startproject`및 `startapp` 명령이면 자동으로 프로젝트 뼈대에 해당하는 디렉터리와 파일을 만들어 줍니다.

## 1.2 MTV 코딩 순서
정해진 순서는 없습니다. MTV 방식에 따르면 화면 설계는 뷰와 템플릿 코딩으로 연결되고, 테이블 설계는 모델 코딩에 반영됩니다. 그렇기 때문에 독립적으로 개발할 수 있는 모델을 먼저 코딩하고, 뷰와 템플릿은 서로 영향을 미치므로 모델 이후에 같이 코딩하는 것이 일반적입니다.  

뷰와 템플릿 역시 순서는 상관없지만, UI 화면을 생각하면서 로직을 풀어나가는 것이 쉽기 때문에  보통은 템플릿을 먼저 코딩합니다. 다만 클래스형 뷰(CBV)처럼 뷰의 코딩이 매우 간단한 경우는 뷰를 먼저 코딩합니다.

### 실습에서의 순서
실습에서는 대부분 CBV이기 때문에 모델, 뷰, 템플릿 순서를 기준으로 진행하며, 그 외에도 프로젝트 설정 파일인 URLconf 파일까지 포함해 다음 순서로 코딩합니다.

- **프로젝트 뼈대 만들기** : 프로젝트 및 앱 개발에 필요한 디렉터리와 파일 생성
- **모델 코딩하기** : 테이블 관련 사항을 개발(models.py, admin.py)
- **URLconf 코딩하기** : URL 및 뷰 매핑 관계를 정의(urls.py)
- **뷰 코딩하기** : 애플리케이션 로직 개발(views.py)
- **템플릿 코딩하기** : 화면 UI 개발(templates/)

## 1.3 settings.py 주요 사항
settings.py는 프로젝트 설정 파일입니다. 기본적인 것들은 장고가 자동으로 등록해주며, 추가적인 것들은 개발하면서 직접 등록하면 됩니다.  

다음 항목들은 프로젝트 개발 시 필수 사항이므로, 장고가 자동으로 등록한 사항을 확인해서 필요하다면 수정해줘야 합니다.
- **데이터베이스 설정** : 디폴트로 `SQLite3` 데이터베이스 엔진을 사용하는 것으로 지정합니다.
- **템플릿 항목 설정** : `TEMPLATES` 항목으로 지정합니다.
- **정적 파일 항목 설정** : `STATIC_URL` 등 관련 항목을 지정합니다.
- **애플리케이션 등록** : 개발하는 앱, 즉 프로젝트에 포함되는 애플리케이션들은 모두 설정 파일에 등록해야 합니다.
- **타임존 지정** : 최초에는 세계표준시(UTC)로 설정되어 있는데, 한국 시간으로 변경해야 합니다.

settings.py는 그 외에도 베이스(루트) 디렉터리를 포함한 각종 디렉터리의 위치, 로그의 형식, 디버그 모드, 보안 관련 사항 등 프로젝트의 전반적인 사항들을 설정해주는 곳으로, 그 내용이 익숙해질수록 장고의 모습을 이해하는데 도움이 됩니다.

## 1.4 models.py 주요 사항
models.py는 테이블을 정의하는 파일입니다. 데이터베이스 처리는 ORM(Object Relation Mapping) 기법을 사용합니다. 즉, 테이블을 클래스로 매핑해서 테이블에 대한  CRUD(Create, Read, Update, Delete) 기능을 클래스 객체에 대해 수행하면, 장고가 내부적으로 데이터베이스에 반영해주는 방식입니다.  

장고에서는 ORM 기법에 따라 테이블을 하나의 클래스로 정의하고, 테이블의 컬럼은 클래스의 변수(속성)로 매핑합니다. 테이블 클래스는 django.db.models.Model 클래스를 상속받아 정의하고, 각 클래스 변수의 타입도 장고에서 미리 정의해 놓은 필드 클래스를 사용합니다.  

테이블의 신규 생성, 테이블의 정의 변경 등 models.py 파일에서 데이터베이스 변경 사항이 발생하면, 이를 데이터베이스에 실제로 반영해주는 작업(migrations)을 해야 합니다. 마이그레이션이란 테이블 및 필드의 생성, 삭제, 변경 등과 같이 데이터베이스에 대한 변경 사항을 알려주는 정보입니다. 물리적으로는 애플리케이션 디렉터리별로 migrations/ 디렉터리 하위에 마이그레이션 파일들이 존재합니다. 장고에서는 `makemigrations` 및 `migrate` 명령으로 실제 데이터베이스에 적용합니다.

## 1.5 URLconf 주요 사항
URLconf 는 URL과 뷰(함수 또는 메소드)를 매핑해주는 urls.py파일입니다. URLconf를 정의할 때는 하나의 파일에 정의할 수도 있고, 2개의 파일에 정의하는 것도 가능합니다.  

프로젝트 전체 URL을 정의하는 **프로젝트 URL** 과 앱마다 정의하는 **앱 URL** , 2계층으로 나눠서 코딩하는 방식을 추천합니다. 이 방식은 URLconf 모듈을 계층적으로 구성하므로 변경도 쉽고 확장도 용이해집니다. 이미 개발해 놓은 앱을 다른 프로젝트에서 사용하는 경우 urls.py 파일을 수정 없이 재활용할 수도 있습니다.  

URL 패턴별로 이름을 지정할 수 있고, 패턴 그룹에 대해 이름공간(namespace)을 지정할 수도 있습니다. 이는 `reverse()`함수나 `{% url %}` 템플릿 태그를 사용해, 소스에 URL을 하드 코딩하지 않아고 필요한 URL을 추출할 수 있는 기능입니다.

## 1.6 views.py 주요 사항

views.py는 뷰 로직을 코딩하는 가장 중요한 파일입니다. 간단한 로직이면 몇 줄만 코딩하면 되지만, 프로젝트 개발 범위가 커짐에 따라 로직도 점점 복잡해지고 views.py 파일의 코딩량도 많아집니다. 즉, 가독성과 유지보수 편리, 재활용 등을 고려해야 합니다.  

장고에서는 뷰 로직을 함수로 코딩할 것인지 클래스로 코딩할 것인지에 따라, **함수형 뷰(Function-based-view)** 와 **클래스형 뷰(Class-based-view)** 로 구분합니다. 개발자가 편한 방식으로 코딩하면 되므로 보통 하나의 프로젝트에 둘 다 사용하는 경우가 많습니다. 다만 클래스형 뷰를 사용하는 것이 장고가 제공하는 제네릭 뷰를 사용할 수 있고 재활용 및 확장성 측면에서 유리하기 때문에, 클래스형 뷰를 더 활용하기를 권장합니다.  

장고는 다른 프레임워크에 비해 뷰 작성에 편리한 기능을 많이 제공하는데, 대표적으로 단축 함수 및 클래스형 제네릭 뷰인데, 쉽고 빠르게 웹 프로그래밍을 할 수 있도록 도와줍니다.

## 1.7 templates 주요 사항

웹 페이지 별로 템플릿 파일(`*.html`)이 하나씩 필요하므로, 웹 프로그램 개발 시 여러 개의 템플릿 파일을 작성하게 되고, 이런 템플릿 파일들을 한 곳으로 모아두기 위한 템플릿 디렉터리가 필요하빈다.  

템플릿 디렉터리는 프로젝트 템플릿 디렉터리와 앱 템플릿 디렉터리를 구분해서 사용합니다. 프로젝트 템플릿 디렉터리는`TEMPLATES` 설정의 `DIRS` 항목에 지정된 디렉터리입니다. 앱 템플릿 디렉터리는 각 애플리케이션 디렉터리마다 존재하는 `templates/` 디렉터리를 말합니다. 프로젝트 템플릿 디렉터리에는 base.html 등 전체 프로젝트의 룩앤필(Look and feel)에 관련된 파일들을 모아두고, 각 앱에서 사용하는 템플릿 파일들은 앱 템플릿 디렉터리에 위치시킵니다.  

예를 들어, mysite 프로젝트에서 bookmark 앱을 개발한다면, 일반적인 경우 템플릿 디렉터리는 다음과 같습니다.

- **프로젝트 베이스(루트) 디렉터리** : /home/user/pyDjango/2nd/
- **프로젝트 디렉터리** : /home/user/pyDjango/2nd/mysite/
- **프로젝트 템플릿 디렉터리** : /home/user/pyDjango/2nd/templates/
- **앱 템플릿 디렉터리** : /home/user/pyDjango/2nd/bookmark/templates/

장고에서는 템플릿 파일들을 찾는 순서도 알아둬야 합니다. 별도로 변경하지 않는다면, 프로젝트 템플릿 디렉터리를 먼저 검색하고 그 다음 앱 템플릿 디렉터리를 검색합니다. 앱 템플릿이 여러개라면 `INSTALED_APPS` 설정 항목에 등록된 순서대로 검색합니다.

## 1.8 Admin 사이트

Admin 사이트는 테이블의 내용을 열람하고 수정하는 기능을 제공합니다. 테이블에 들어 있는 내용들을 콘텐츠라고 하는데, Admin 사이트는 이 콘텐츠를 편집하는 기능을 제공합니다.  

이 Admin 사이트에서 User와 Group 테이블을 포함해, 테이블에 대한 데이터의 입력, 수정, 삭제 등의 작업을 할 수 있습니다. Admin 화면에서 기본적으로 User와 Group 테이블이 보이는 것은 이미 settings.py 파일에 django.contrib.auth 애플리케이션이 등록되어 있기 때문입니다.  

Admin 기능은 자주 사용되는 편리한 기능으로, 필요할 때 언제든지 SQL 없지도 테이블의 모습 및 내용을 확인하고 테이블에 레코드를 입력하고 수정할 수 있습니다. Admin 사이트에 원하는 테이블을 등록하기 위해서는 admin.py 파일에 작업하면 됩니다.

## 1.9 개발용 웹 서버 - runserver

개발 과정에서 작성된 코드를 실행하고 테스트하는 과정이 필요합니다. 장고에서는 현재 웹 프로그래을 실행해 볼 수 있는 `runserver`라는 테스트용 웹 서버를 제공합니다.  

하지만, 프로젝트를 상용화를 고려한다면, runserver 대신 Apache 또는 Nginx 등의 상용 웹 서버를 사용해야 합니다. 개발용으로 제공되는 runserver는 상용 웹 서버에 비해 처리 능력도 떨어지고 보안에도 취약하기 때문입니다.
