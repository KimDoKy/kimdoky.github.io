---
layout: post
section-type: post
title: pyDjango - chap15. 장고 핵심 기능 - View
category: django
tags: [ 'django' ]
---
뷰는 웹 요청을 받아서 최종 응답 데이터를 웹 클라이언트로 반환하는 함수(정확히는 호출 가능한 객체, callable)입니다. 웹 요청을 분석하고 데이터베이스 처리 등 필요한 로직을 수행하고, 템플릿을 통해 화면에 표시할 데이터를 만들어서, 최종 데이터를 웹 클라이언트에 응답해줍니다.  

장고에서는 뷰를 함수로도 작성할 수 있고, 클래스로도 작성할 수 있습니다. 간단한 로직인 경우 함수형 뷰로 신속하게 개발하는 것도 하나의 방법이지만, 로직이 복잡해지고 프로젝트가 커질수록 클래스형 뷰의 장점이 효과를 발휘합니다. 또한 장고는 잘 준비된 클래스형 제네릭 뷰를 제공하고 있습니다.  

이번 챕터에서는 클래스형 뷰의 핵심 원리들을 설명합니다. 상속의 중요 기능인 오버라이딩, 클래스형 뷰의 내부 처리 과정을 이해할 수 있는 Method Flowchart, 다중 상속에 필요한 MRO 등을 설명합니다. 추가로 뷰 작성시 자주 사용하는 페이징 처리와 단축 함수를 다룹니다.

## 15.1 제네릭 뷰 선택
클래스형 뷰를 작성하기 위해서는 클래스형 제네릭 뷰를 상속받아서 필요한 속성과 메소드를 오버라이딩하는 작업이 필요합니다. 이를 위해서는 사용하려는 로직에 가장 알맞는 제네릭 뷰가 무엇인지 선택할 수 있어야 합니다.
제네릭 뷰를 선택한 다음에는 그 제네릭 뷰에서 어떤 속성과 메소드를 오버라이딩할지 판단해야 합니다.

## 15.1.1 제네릭 뷰 요약
장고는 웹 프로그래밍 개발시 공통적으로 사용하는 로직을 미리 개발해 놓고 기본 클래스로 제공하고 있습니다. 개발자는 자신의 로직에 맞는 뷰를 잘 선택해서 사용하면 됩니다. 그래서 적절한 제네릭 뷰를 선택할 수 있도록, 제네릭 뷰의 종류와 각 제네릭 뷰의 역할을 이해하는 것이 중요합니다.  

제네릭 뷰 분류 | 제네릭 뷰 이름 | 뷰의 기능 또는 역할
---|---|---
Base View | View <br> TemplateView <br> RedirectView | 가장 기본이 되는 최상위 제네릭 뷰입니다. 다른 모든 제네릭 뷰들은 View의 하위 클래스입니다. <br> 템플릿이 주어지면 해당 템플릿을 렌더링해줍니다. <br> URL이 주어지면 해당 URL로 리다리렉트 시켜줍니다.
Generic Display View | DetailView <br> ListView | 객체 하나에 대한 생세한 정보를 보여줍니다. <br> 조건에 맞는 여러 개의 객체를 보여줍니다.
Generic Edit View | FormView <br> CreateView <br> UpdateView <br> DeleteView | 폼이 주어지면 해당 폼을 보여줍니다. <br> 객체를 생성하는 폼을 보여줍니다. <br> 기존 객체를 수정하는 폼을 보여줍니다. <br> 기존 객체를 삭제하는 폼을 보여줍니다.
Generic Date View | YearArchiveView <br> MonthArchiveView <br> WeekArchiveView <br> DayArchiveView <br> TodayArchiveView <br> DateDetailView | 년도가 주어지면 그 년도에 해당하는 객체들을 보여줍니다. <br> 연, 월이 주어지면 그에 해당하는 객체들을 보여줍니다. <br> 연도와 주차(week)가 주어지면 그에 해당하는 객체들을 보여줍니다. <br> 연, 월, 일이 주어지면 그 날짜에 해당하는 객체들을 보여줍니다. <br> 오늘 날짜에 해당하는 객체들을 보여줍니다. <br> 연, 월, 일 기본 키(또는 슬러그)가 주어지면 그에 해당하는 특정 객체 하나에 대한 상세한 정보를 보여줍니다.

### 15.1.2 View
모든 클래스현 뷰의 기본이 되는 최상위 뷰입니다. 따라서 모든 클래스형 뷰는 이 View 클래스를 상속받습니다. 이 뷰를 직접 상속받아 코딩하는 경우는 많지 않을테지만, 원하는 로직에 맞는 제네릭 뷰가 없는 경우 이 뷰를 상속받아 직접 클래스형 뷰를 작성 할 수 있습니다.  

밑의 TestView는 직접 View 클래스를 상속받아서 get() 메소드를 직접 정의하고, 'Hello World!'를 화면에 출력하는 클래스형 뷰를 구현했습니다.

```python
class TestView(View):
    def get(self, request, *arg, **kwargs):
        return HttpResponse('Hello World!')
```

### 15.1.3 TemplateView
단순하게 화면에 보여줄 템플릿 파일을 처리하는 정도의 간단한 뷰입니다. 아주 간단하게는 템플릿 파일만 지정해주면 됩니다.  

[chap4의 HomeView](https://kimdoky.github.io/django/2017/09/03/pyDjango-ch4.html){:target=`_`blank}는 TemplateView 제네릭 뷰를 상속받고 있으며, home.html 템플릿 파일을 렌더링해서 화면에 보여주는 것이 주된 역할입니다.

```python
class HomeView(TemplateView):
    template_name = 'home.html'
```

### 15.1.4 RedirectView
주어진 URL로 리다이렉트시켜주는 제네릭 뷰입니다. 그래서 URL 속성이 필수입니다. URL 대신 URL 패턴명이 주어져도 URL을 알아낼 수 있습니다. 만일 URL을 알 수 없다면, RedirectView는 HttpResponseGone (410) 에러 응답을 발생시킵니다. 간단하게 설명하면, RedirectView는 복잡한 로직 없이 리다이렉트만 원할 때 사용하는 뷰입니다.

```python
class TestRedirectView(RedirectView):
    url = '/blog/post/'
    # 다음처럼 URL 대신에 패턴명을 지정해도 됩니다.
    # pattern_name = 'blog:post_list'
```

### 15.1.5 DetailView
ListView와 더불어 가장 많이 사용되는 제네릭 뷰입니다. DetailView는 특정 객체 하나에 대한 정보를 보여주는 뷰입니다. 자주 사용되는 예는, 테이블에서 기본 키(PK)로 지정된 레코드 하나에 대한 정보를 보여주는 것입니다.  

다음 예는 [chap3의 PostDV 뷰](https://kimdoky.github.io/django/2017/08/30/pyDjango-ch3.html){:target=`_`blank}입니다. Post 테이블에서 특정 특정 레코드 하나를 읽은 후에, 그 레코드를 object 컨텍스트 변수에 담아서 템플렛에 넘겨 줍니다. 템플릿 파일에서는 `{{ object }}` 변수를 사용해, 레코드 정보들을 출력합니다.

```python
class PostDV(DetailView):
    model = Post
```

또 한 가지 중요한 점은 위 코드에서 Post 테이블만 지정했는데 어떻게 특정 레코드를 읽어올 수 있을까요? 해답은 URLconf에 있습니다. [chap3](https://kimdoky.github.io/django/2017/08/30/pyDjango-ch3.html){:target=`_`blank}를 보면 PostDV 뷰를 호출하는 코드를 찾을 수 있습니다.

```python
    # ex: /post/django-example/
    url(r'^post/(?P<slug>[-\w]+)/$', PostDV.as_view(), name='post_detail'),
```
위 URL 정의에 따르면 만일 /blog/post/django-example/ 이라는 URL이 들어오면, PostDV.as_view() 를 호출 시 인자로 사전 데이터 `{'slug': 'django-example'}`을 넘겨줍니다. 이 slug 인자로 Post 테이블을 검색해 slug 컬럼이 django-example인 레코드를 찾게 됩니다. 즉 DetailView 제네릭 뷰를 사용 시, 테이블은 뷰 클래스에서 지정하고 레코드 검색용 키는 URLconf에서 지정하는 것입니다. 레코드 검색용 키는 보통 기본 키(PK)를 사용하는데, 이 예처럼 slug를 사용하기도 합니다.

### 15.1.6 ListView
