I"Ût<blockquote>
  <p><a href="https://www.feldroy.com/books/two-scoops-of-django-3-x">Two Scoops of Django 3.x</a></p>
</blockquote>

<hr />

<h1 id="djangoì˜-ì‚¬ìš©ì-ëª¨ë¸-ë‹¤ë£¨ê¸°">Djangoì˜ ì‚¬ìš©ì ëª¨ë¸ ë‹¤ë£¨ê¸°</h1>

<h2 id="221-use-djangos-tools-for-finding-the-usermodel">22.1 Use Djangoâ€™s Tools for Finding the UserModel</h2>

<p>ì‚¬ìš©ì í´ë˜ìŠ¤ë¥¼ ì°¾ëŠ” ë°©ë²•</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ê¸°ì¡´ ì‚¬ìš©ì ëª¨ë¸ì˜ ì •ì˜
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">get_user_model</span><span class="p">()</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="nc">django</span><span class="p">.</span><span class="n">contrib</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="n">User</span><span class="o">&gt;</span>

<span class="c1"># í”„ë¡œì íŠ¸ì—ì„œ ì»¤ìŠ¤í…€ ì‚¬ìš©ì ëª¨ë¸ ì •ì˜ë¥¼ ì´ìš©í•  ë•Œ
</span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">get_user_model</span><span class="p">()</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="nc">profiles</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="n">UserProfile</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>í”„ë¡œì íŠ¸ì„¤ì •ì— ë”°ë¼ ë‹¤ë¥¸ ë‘ ê°œì˜ User ëª¨ë¸ì´ ì¡´ì¬í•  ìˆ˜ ìˆê³ , User ëª¨ë¸ì€ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.</p>

<h3 id="2211-use-settingsauth_user_model-for-foreign-keys-to-user">22.1.1 Use <code class="language-plaintext highlighter-rouge">settings.AUTH_USER_MODEL</code> for Foreign Keys to User</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">IceCreamStore</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">SET_NULL</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
</code></pre></div></div>

<p>í”„ë¡œì íŠ¸ê°€ ì…‹íŒ…ë˜ì—ˆë‹¤ë©´ <code class="language-plaintext highlighter-rouge">settings.AUTH_USER_MODEL</code>ì„ ìˆ˜ì •í•˜ì§€ ë§ì.</p>

<p>ìˆ˜ì •í•˜ë ¤ë©´ DB ìŠ¤í‚¤ë§ˆë¥¼ ì•„ì— ë§ê²Œ ìˆ˜ì •í•´ì•¼ë§Œ í•©ë‹ˆë‹¤.</p>

<h3 id="2212-dont-use-get_user_model-for-foreign-keys-to-user">22.1.2 Donâ€™t Use <code class="language-plaintext highlighter-rouge">get_user_model()</code> for Foreign Keys to User</h3>

<p>ì™¸ë˜í‚¤ì— <code class="language-plaintext highlighter-rouge">get_user_model()</code>ì„ ì‚¬ìš©í•˜ë©´ ì„í¬íŠ¸ ë£¨í”„ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Don't Do This!!
</span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">IceCreamStore</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">get_user_model</span><span class="p">(),</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">SET_NULL</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">get_user_model</code>ì€ User ëª¨ë¸ì´ ì´ë¯¸ ì•± ìºì‹œì— ë¡œë“œë˜ì—ˆë‹¤ëŠ”ê±¸ ë³´ì¥í•  ìˆ˜ ì—†ìœ¼ë©°, ì¼ë¶€ ì„¤ì •(<code class="language-plaintext highlighter-rouge">INSTALLED_APPS</code>)ì´ ë³€ê²½ë˜ë©´ import ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">settings.AUTH_USER_MODEL</code>ì€ ëª¨ë¸ ì´ë¦„ì„ ë¬¸ìì—´ë¡œ ë¦¬í„´í•˜ê³ , ëª¨ë¸ í´ë˜ìŠ¤ ê²€ìƒ‰ì— ì‹¤íŒ¨í•˜ë©´ ëª¨ë“  ëª¨ë¸ í´ë˜ìŠ¤ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ê²€ìƒ‰ì´ ì§€ì—°ë©ë‹ˆë‹¤.</p>

<blockquote>
  <p><a href="https://stackoverflow.com/questions/24629705/django-using-get-user-model-vs-settings-auth-user-model">stackoverflow</a></p>
</blockquote>

<h2 id="222-custom-user-fields-for-django-projects">22.2 Custom User Fields for Django Projects</h2>

<p>ê·œì¹™ì— ë§ê²Œ í•„ìš”í•œ ë©”ì„œë“œì™€ ì†ì„±ì„ êµ¬í˜„í•˜ì—¬ ì»¤ìŠ¤í…€ ìœ ì € ëª¨ëŒˆì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><a href="https://github.com/fusionbox/django-authtools"><code class="language-plaintext highlighter-rouge">django-authtools</code></a>ëŠ” ì»¤ìŠ¤í…€ ì‚¬ìš©ì ëª¨ë¸ì„ ë” ì‰½ê²Œ ì •ì˜í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">AbstractEmailUser</code>, <code class="language-plaintext highlighter-rouge">AbsteactNameUser</code> ëª¨ë¸ì„ ì´ìš©í•©ë‹ˆë‹¤. Django 3.xì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•Šì§€ë§Œ, í•œ ë²ˆ ì‚´í´ë³¼ ê°€ì¹˜ëŠ” ìˆìŠµë‹ˆë‹¤.</p>

<h3 id="2221-option1-subclass-abstractuser">22.2.1 Option1: Subclass AbstractUser</h3>

<p>Djangoì˜ User ëª¨ë¸ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©´ì„œ ëª‡ëª‡ í•„ë“œë¥¼ ì¶”ê°€í• ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># profiles/models.py
</span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">AbstractUser</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">KarmaUser</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="n">karma</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">'karma'</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>í•´ë‹¹ ëª¨ë¸ì„ ì‚¬ìš©í•˜ë ¤ë©´ settingsì— ì¶”ê°€ ì„¤ì •ì„ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s">'profiles.KarmaUser'</span>
</code></pre></div></div>

<h3 id="2222-option2-subclass-abstactbaseuser">22.2.2 Option2: Subclass AbstactBaseUser</h3>

<p><code class="language-plaintext highlighter-rouge">password</code>, <code class="language-plaintext highlighter-rouge">last_login</code> í•„ë“œë§Œ ê°€ì§„ ê¸°ë³¸ í˜•íƒœì˜ ì˜µì…˜ì…ë‹ˆë‹¤.</p>

<ul>
  <li>User ëª¨ë¸ì´ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” í•„ë“œ(<code class="language-plaintext highlighter-rouge">first_name</code>, <code class="language-plaintext highlighter-rouge">last_name</code>)ì— ë§Œì¡±í•˜ì§€ ëª»í•  ë•Œ</li>
  <li>ê¸°ë³¸ í˜•íƒœë§Œ ê°€ì§„ ê°€ë²¼ìš´ ìƒíƒœë¡œë¶€í„° ìƒˆë¡œ ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ì„œ, íŒ¨ìŠ¤ì›Œë“œë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">AbstractBaseUser</code>ì˜ ê¸°ë³¸ í™˜ê²½ì˜ ì¥ì ì„ ì´ìš©í•˜ê³  ì‹¶ì„ ë•Œ</li>
  <li><a href="https://docs.djangoproject.com/en/3.2/topics/auth/customizing/#a-full-example">https://docs.djangoproject.com/en/3.2/topics/auth/customizing/#a-full-example</a></li>
  <li>https://github.com/fusionbox/django-authtools</li>
</ul>

<h3 id="2223-option3-linking-back-form-a-related-model">22.2.3 Option3: Linking Back Form a Related Model</h3>
<p>ê´€ë ¨ ëª¨ë¸ë¡œë¶€í„° ì—­ìœ¼ë¡œ ë§í¬í•˜ê¸°</p>

<ul>
  <li>ì´ìš©ì‚¬ë¡€: ì„œë“œ íŒŒí‹° íŒ¨í‚¤ì§€ ì œì‘
    <ul>
      <li>PyPIì— ì˜¬ë¦´ ì„œë“œ íŒŒí‹° ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì œì‘í•  ë•Œ</li>
      <li>ì‚¬ìš©ìë‹¹ ì¶”ê°€ë¡œ ì €ì¥í•´ì•¼ í•  ì •ë³´ê°€ ìˆì„ ë•Œ</li>
      <li>ìµœëŒ€í•œ ëŠìŠ¨í•œ ì—°ê´€ëœ ê´€ê³„ë¥¼ ì›í•  ë•Œ</li>
    </ul>
  </li>
  <li>ì´ìš©ì‚¬ë¡€: ë‚´ë¶€ì ìœ¼ë¡œ í•„ìš”í•œ ê²½ìš°
    <ul>
      <li>ìš°ë¦¬ë§Œì˜ Django í”„ë¡œì íŠ¸ë¥¼ ì‘ì—…í•  ë•Œ</li>
      <li>ê°ê¸° ë‹¤ë¥¸ í•„ë“œë¥¼ ê°€ì§„ ì „í˜€ ë‹¤ë¥¸ ì‚¬ìš©ì íƒ€ì…ì„ ì›í•  ë•Œ</li>
      <li>ì‚¬ìš©ì ì¤‘ ì¼ë¶€ê°€ ë‹¤ë¥¸ ì‚¬ìš©ì íƒ€ì…ì„ ê°€ì§€ëŠ” ì‚¬ìš©ìë“¤ê³¼ ì„ì—¬ ìˆì„ ë•Œ</li>
      <li>ë‹¤ë¥¸ ë ˆë²¨ë‹¨ì´ ì•„ë‹Œ ëª¨ë¸ ë ˆë²¨ì—ì„œ ëª¨ë“  ê²ƒì„ ì²˜ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ</li>
      <li>ì˜µì…˜1, 2ì• ì„œ ë‹¤ë£¬ ì»¤ìŠ¤í…€ ì‚¬ìš©ì ëª¨ë¸ê³¼ ê²°í•©í•˜ì—¬ ì´ìš©í•˜ê³  ì‹¶ì„ ë•Œ</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># profiles/models.py
</span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">flavors.models</span> <span class="kn">import</span> <span class="n">Flavor</span>

<span class="k">class</span> <span class="nc">EaterProfile</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ê¸°ì¡´ ì‚¬ìš©ì í”„ë¡œí•„
</span>    <span class="c1"># ì´ëŸ¬í•œ ë°©ì‹ì„ ì´ìš©í•œë‹¤ë©´ post_save ì‹œê·¸ë„ì´ë‚˜
</span>    <span class="c1"># ìµœì´ˆ ë¡œê·¸ì¸ì‹œ profile_edit ë·°ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ëŠ” ì ˆì°¨ê°€ í•„ìš”í•˜ë‹¤.
</span>    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">SET_NULL</span><span class="p">)</span>
    <span class="n">favorite_ice_cream</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Flavor</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ScooperProfile</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">SET_NULL</span><span class="p">)</span>
    <span class="n">scoops_scooped</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">InventorProfile</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">SET_NULL</span><span class="p">)</span>
    <span class="n">flavors_invented</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Flavor</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>ORM(<code class="language-plaintext highlighter-rouge">user.eaterprofile.favorite_ice_cream</code>)ì„ í†µí•´ ì†ì‰½ê²Œ ì—­ìœ¼ë¡œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
Scooper, Inventor ì—­ì‹œ í•´ë‹¹ ì‚¬ìš©ìì—ê²Œë§Œ í•´ë‹¹í•˜ëŠ” ê°œì¸ ë°ì´í„°ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
ì´ë ‡ê²Œ êµ¬ì„±í•˜ë©´ ì‚¬ìš©ì ëª¨ë¸ê³¼ëŠ” ë…ë¦½ëœ ì •ë³´ì´ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì íƒ€ì… ì‚¬ì´ì—ì„œ ë¬¸ì œê°€ ë°œí–‰ë  í™•ë¥ ì´ <strong>ë§¤ìš° ë‚®ì•„ì§„ë‹¤.</strong></p>

<p>í”„ë¡œíŒŒì¼ì´ë‚˜ ê·¸ì™€ ê´€ë ¨ëœ íŒŒì¼ë“¤ì´ ë„ˆë¬´ ë‹¨ìˆœí•´ì ¸ë²„ë¦´ ìˆ˜ ìˆì§€ë§Œ, ì½”ë“œë¥¼ ë‹¨ìˆœí•˜ê²Œ ìœ ì§€í•˜ëŠ” ê²ƒì´ ê¼­ ë‹¨ì ì´ì ì¥ì ì´ ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="223-handling-multiple-user-types">22.3 Handling Multiple User Types</h2>

<p>ì—¬ëŸ¬ ì‚¬ìš©ì ìœ í˜•(ì§ì›, ê´€ë¦¬ì, ì¼ë°˜ ì‚¬ìš©ì ë“±)ì„ ì²˜ë¦¬í•  ë•ŒëŠ”, í•˜ë‚˜ì˜ ëª¨ë¸ì„ ì‚¬ìš©í•˜ê³  ì ì ˆíˆ í‘œì‹œë§Œ í•´ì£¼ë©´ ë©ë‹ˆë‹¤.</p>

<h3 id="2231-add-a-user-type-field">22.3.1 Add a User Type Field</h3>

<p>User ëª¨ë¸ì— ì‚¬ìš©ì ìœ í˜•ì„ êµ¬ë¶„í•˜ëŠ” í•„ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Types</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">TextChoices</span><span class="p">):</span>
        <span class="n">EATER</span> <span class="o">=</span> <span class="s">"EATER"</span><span class="p">,</span> <span class="s">"Eater"</span>
        <span class="n">SCOOPER</span> <span class="o">=</span> <span class="s">"SCOOPER"</span><span class="p">,</span> <span class="s">"Scooper"</span>
        <span class="n">INVENTOR</span> <span class="o">=</span> <span class="s">"INVENTOR"</span><span class="p">,</span> <span class="s">"Inventor"</span>

    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">_</span><span class="p">(</span><span class="s">"Type"</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="n">choices</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="n">EATER</span>
        <span class="p">)</span>
</code></pre></div></div>

<p>ì‹œê°„ì˜ ì§€ë‚¨ì— ë”°ë¼ ì‚¬ì´íŠ¸ì˜ í¬ê¸°ì™€ ë³µì¡ì„±ì˜ ì¦ê°€í•˜ê¸° ë•Œë¬¸ì— ìœ í˜• êµ¬ë¶„ì„ ìœ„í•œ í•„ë“œì— booleanë³´ë‹¤ëŠ” charì˜ ë‹¨ì¼ í•„ë“œë¥¼ ìƒí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.</p>

<p>ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ì—­í• ì„ ê°€ì ¸ì•¼ í•œë‹¤ë©´ <code class="language-plaintext highlighter-rouge">ManyToManyField</code>ë¥¼ ì´ìš©í•˜ê±°ë‚˜ Djangoì˜ ë‚´ì¥ ê·¸ë£¹ ì‹œìŠ¤í…œì„ ì´ìš©í•˜ì„¸ìš”.</p>

<h3 id="2232-add-a-user-type-field-plus-proxy-models">22.3.2 Add a User Type Field Plus Proxy Models</h3>

<p>ë‹¤ë¥¸ ìœ í˜•ì˜ ì‚¬ìš©ìëŠ” ë‹¤ë¥¸ ë©”ì„œë“œì™€ ì†ì„±ì„ ê°€ì§‘ë‹ˆë‹¤.</p>

<p>í”„ë¡ì‹œ ëª¨ë¸ì„ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Types</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">TextChoices</span><span class="p">):</span>
        <span class="n">EATER</span> <span class="o">=</span> <span class="s">"EATER"</span><span class="p">,</span> <span class="s">"Eater"</span>
        <span class="n">SCOOPER</span> <span class="o">=</span> <span class="s">"SCOOPER"</span><span class="p">,</span> <span class="s">"Scooper"</span>
        <span class="n">INVENTOR</span> <span class="o">=</span> <span class="s">"INVENTOR"</span><span class="p">,</span> <span class="s">"Inventor"</span>

    <span class="c1"># í”„ë¡ì‹œ ëª¨ë¸ì„ í†µí•´ ìƒˆë¡œìš´ ì‚¬ìš©ìê°€ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸
</span>    <span class="n">base_type</span> <span class="o">=</span> <span class="n">Types</span><span class="p">.</span><span class="n">EATER</span>

    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">_</span><span class="p">(</span><span class="s">"Type"</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="n">choices</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="n">EATER</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># ì‹ ê·œ ì‚¬ìš©ìë¼ë©´, base_typeì„ ê¸°ë°˜ìœ¼ë¡œ ìœ í˜•ì„ ì§€ì •
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">pk</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">base_type</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">().</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># users/models.py
</span><span class="k">class</span> <span class="nc">InventorManager</span><span class="p">(</span><span class="n">BaseUserManager</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="nb">super</span><span class="p">().</span><span class="n">get_queryset</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">User</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">INVENTOR</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Inventor</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="c1"># ì‚¬ìš©ì ìœ í˜•ì„ INVENTORìœ¼ë¡œ ì„¤ì •
</span>    <span class="n">base_type</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">INVENTOR</span>
    <span class="c1"># Inventor ëª¨ë¸ì— ëŒ€í•œ ì¿¼ë¦¬ê°€ Inventorsë§Œ ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸
</span>    <span class="n">objects</span> <span class="o">=</span> <span class="n">InventorManager</span><span class="p">()</span>

    <span class="c1"># Trueì´ë©´ ì´ ë ˆì½”ë“œì— ëŒ€í•œ í…Œì´ë¸”ì„ ìƒì„±í•˜ì§€ ì•ŠìŒ
</span>    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">invent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"Delicious!"</span>
</code></pre></div></div>

<p>í”„ë¡ì‹œ ëª¨ë¸ì€ í•„ë“œë¥¼ ì¶”ê°€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<p>í”„ë¡ì‹œ ëª¨ë¸ì€ ì»¤ìŠ¤í…€ ë§¤ë‹ˆì €, ë©”ì„œë“œ, ì†ì„±ì„ ê±¸ ìˆ˜ ìˆëŠ” ëª¨ë¸ ê°œì²´ì— ëŒ€í•œ ì°¸ì¡°ì…ë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> from users.models import User, Inventor
<span class="o">&gt;&gt;&gt;</span> User.objects.count<span class="o">()</span> <span class="c"># Over 300 million users! 323482357</span>
<span class="o">&gt;&gt;&gt;</span> Inventor.objects.count<span class="o">()</span> <span class="c"># But only 3 inventors 3</span>

<span class="c"># Calling someone as both a User and an Inventor</span>
<span class="o">&gt;&gt;&gt;</span> user <span class="o">=</span> User.objects.get<span class="o">(</span><span class="nv">username</span><span class="o">=</span><span class="s1">'uma'</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> user
&lt;User: uma&gt;
<span class="o">&gt;&gt;&gt;</span> inventor <span class="o">=</span> Inventor.objects.get<span class="o">(</span><span class="nv">username</span><span class="o">=</span><span class="s1">'uma'</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> inventor
&lt;Inventor: uma&gt;

<span class="c"># Calling a method that's only for inventors</span>
<span class="o">&gt;&gt;&gt;</span> user.invent<span class="o">()</span>
AttributeError
<span class="o">&gt;&gt;&gt;</span> inventor.invent<span class="o">()</span>
<span class="s1">'Delicious'</span>
</code></pre></div></div>

<p>í”„ë¡ì‹œ ì ‘ê·¼ ë°©ì‹ì€ <code class="language-plaintext highlighter-rouge">django.contrib.auth</code> ë¥¼ ê·¹ì ìœ¼ë¡œ í™•ì¥í•˜ì§€ ì•Šê³ , ìƒˆë¡œìš´ ì‚¬ìš©ì í…Œì´ë¸”ì„ ìƒì„±í•˜ê±°ë‚˜ íƒ€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„ ì—¬ëŸ¬ ìœ í˜•ì˜ ì‚¬ìš©ìë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

<p>í”„ë¡ì‹œ ëª¨ë¸ì´ ìì²´ ëª¨ë¸ ë§¤ë‹ˆì €ë¥¼ ê°€ì§ˆìˆ˜ ìˆë‹¤ëŠ” ê²ƒì€ ë” ë§ì€ ëª…ì‹œì  ì¿¼ë¦¬ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> User.objects.filter<span class="o">(</span><span class="nb">type</span><span class="o">=</span>User.Types.INVENTOR<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> Inventor.objects.filter<span class="o">()</span>  <span class="c"># Our preference</span>
</code></pre></div></div>

<h3 id="2233-adding-extra-data-fields">22.3.3 Adding Extra Data Fields</h3>

<p>ë‹¤ì–‘í•œ ìœ í˜•ì˜ ì‚¬ìš©ìì˜ ì¶”ê°€ ë°ì´í„° í•„ë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">OneToOneField</code> ê´€ê³„ë¥¼ í”„ë¡œíŒŒì¼ ëª¨ë¸ì— ì‚¬ìš©
    <ul>
      <li><a href="">Chap22.2.3: Option 3: Linking Back From a Related Model</a></li>
    </ul>
  </li>
  <li>ëª¨ë“  í•„ë“œì— ê¸°ë³¸ User ëª¨ë¸ì„ ë„£ìŠµë‹ˆë‹¤.
    <ul>
      <li>User í…Œì´ë¸”ì´ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ</li>
      <li>ì‚¬ìš©í•˜ì§€ë„ ì•ŠëŠ” ë°ì´í„°ë“¤ì„ ë³´ê´€í•˜ê²Œ ë  ìˆ˜ë„ ìˆìŒ</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Inventor</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">InventorManager</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">extra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">inventorprofile</span>

<span class="k">class</span> <span class="nc">Scooper</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">ScooperManager</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">extra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">scooperprofile</span>

<span class="k">class</span> <span class="nc">Eater</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="n">EaterManager</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">extra</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">eaterprofile</span>
</code></pre></div></div>

<p>User ìœ í˜•ì— ê´€ê³„ì—†ì´ ì¼ëŒ€ì¼ ê´€ê³„ì˜ í”„ë¡œí•„ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">invented.extra.flavors_invented</code></li>
  <li><code class="language-plaintext highlighter-rouge">scooper.extra.scoops_scooped</code></li>
  <li><code class="language-plaintext highlighter-rouge">eater.extra.favorite_ice_cream</code></li>
</ul>

<h3 id="2234-additional-resources-on-multiple-user-types">22.3.4 Additional Resources on Multiple User Types</h3>

<ul>
  <li><a href="https://www.youtube.com/watch?v=f0hdXr2MOEA">https://www.youtube.com/watch?v=f0hdXr2MOEA</a></li>
  <li><a href="https://docs.djangoproject.com/en/3.1/topics/db/models/#proxy-models">https://docs.djangoproject.com/en/3.1/topics/db/models/#proxy-models</a></li>
  <li><a href="https://simpleisbetterthancomplex.com/tutorial/2018/01/18/how-to-implement-multiple-user-types-with-django.html">https://simpleisbetterthancomplex.com/tutorial/2018/01/18/how-to-implement-multiple-user-types-with-django.html</a></li>
</ul>

<h2 id="224-summary">22.4 Summary</h2>

<ul>
  <li>Custom User Modelì„ ì •ì˜í•˜ëŠ” ë°©ë²•</li>
  <li>í”„ë¡ì‹œ ëª¨ë¸</li>
</ul>
:ET