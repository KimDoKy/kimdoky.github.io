I"Òf<h1 id="django-rest-framework---testing">Django REST Framework - Testing</h1>

<p><em><strong>â€œCode without tests is broken as designed.â€<br />
â€œí…ŒìŠ¤íŠ¸ê°€ ì—†ëŠ” ì½”ë“œëŠ” ì˜ë„ í•œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.â€ - Jacob Kaplan-Moss</strong></em></p>

<p>REST í”„ë ˆì„ì›Œí¬ëŠ” Djangoì˜ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ í™•ì¥í•˜ê³ , API Requests ì‘ì„±ì— ëŒ€í•œ ì§€ì›ì„ í–¥ìƒì‹œí‚¤ëŠ” ì„œí¬íŠ¸ í´ë˜ìŠ¤ë¥¼ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="apirequestfactory">APIRequestFactory</h2>
<p>Djangoì˜ ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">RequestFactory</code> í´ë˜ìŠ¤ë¥¼ í™•ì¥í•©ë‹ˆë‹¤.</p>

<h3 id="creating-test-requests">Creating test requests</h3>
<p><code class="language-plaintext highlighter-rouge">APIRequestFactory</code> í´ë˜ìŠ¤ëŠ” Djangoì˜ í‘œì¤€ <code class="language-plaintext highlighter-rouge">RequestFactory</code> í´ë˜ìŠ¤ì™€ ê±°ì˜ ë™ì¼í•œ APIë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ì¦‰ í‘œì¤€ <code class="language-plaintext highlighter-rouge">.get()</code>, <code class="language-plaintext highlighter-rouge">.post()</code>, <code class="language-plaintext highlighter-rouge">.put()</code>, <code class="language-plaintext highlighter-rouge">.patch()</code>, <code class="language-plaintext highlighter-rouge">.delete()</code>, <code class="language-plaintext highlighter-rouge">.head()</code> ë° <code class="language-plaintext highlighter-rouge">.options()</code> ë©”ì„œë“œë¥¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rom rest_framework.test import APIRequestFactory

# í‘œì¤€ `RequestFactory` APIì„ ì‚¬ìš©ã…ì—¬ POST request formì„ ë§Œë“ ë‹¤.
factory = APIRequestFactory()
request = factory.post('/notes/', {'title': 'new idea'})
</code></pre></div></div>

<h4 id="using-the-format-argument">Using the <code class="language-plaintext highlighter-rouge">format</code> argument</h4>
<p><code class="language-plaintext highlighter-rouge">post</code>,<code class="language-plaintext highlighter-rouge">put</code>,<code class="language-plaintext highlighter-rouge">patch</code>ì™€ ê°™ì€ requestsë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œì—ëŠ” content typeì„ ì‚¬ìš©í•˜ì—¬ requestsë¥¼ ì‰½ê²Œ ìƒì„± í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” argumentê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Create a JSON POST request
factory = APIRequestFactory()
request = factory.post('/notes/', {'title': 'new idea'}, format='json')
</code></pre></div></div>

<p>ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ í˜•ì‹ì€ <code class="language-plaintext highlighter-rouge">multipart</code>ì™€ <code class="language-plaintext highlighter-rouge">json</code>ì…ë‹ˆë‹¤. Djangoì˜ ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">RequestFactory</code>ì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ ê¸°ë³¸ í˜•ì‹ì€ <code class="language-plaintext highlighter-rouge">multipart</code>ì…ë‹ˆë‹¤.</p>

<p>ë” ë§ì€ í˜•ì‹ì— ëŒ€í•œ ì •ë³´ëŠ” <a href="http://www.django-rest-framework.org/api-guide/testing/#configuration">configuration section</a>ì„ ì°¸ì¡°í•˜ì„¸ìš”.</p>

<h4 id="explicitly-encoding-the-request-body">Explicitly encoding the request body</h4>
<p>request ë³¸ë¬¸ì„ ëª…ì‹œì ìœ¼ë¡œ ì¸ì½”ë”©í•´ì•¼ í•˜ëŠ” ê²½ìš° <code class="language-plaintext highlighter-rouge">context_type</code> í”Œë˜ê·¸ë¥¼ ì„¤ì •í•˜ì—¬ request ë³¸ë¬¸ì„ ì¸ì½”ë”©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>request = factory.post('/notes/', json.dumps({'title': 'new idea'}), content_type='application/json')
</code></pre></div></div>

<h4 id="put-and-patch-with-form-data">PUT and PATCH with form data</h4>
<p>Djangoì˜ <code class="language-plaintext highlighter-rouge">RequestFactory</code>ì™€ REST í”„ë ˆì„ ì›Œí¬ì˜ <code class="language-plaintext highlighter-rouge">APIRequestFactory</code> ì‚¬ì´ì— ì£¼ëª©í•  ë§Œí•œ ì°¨ì´ì ì€ ë‹¤ì¤‘ íŒŒíŠ¸ ì–‘ì‹ ë°ì´í„°ê°€ <code class="language-plaintext highlighter-rouge">.post()</code> ì´ì™¸ì˜ ë©”ì†Œë“œë¡œ ì¸ì½”ë”©ëœë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>

<p>ì˜ˆë¥¼ ë“¤ì–´, <code class="language-plaintext highlighter-rouge">APIRequestFactory</code>ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ <code class="language-plaintext highlighter-rouge">put</code>ìš”ì²­ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>factory = APIRequestFactory()
request = factory.put('/notes/547/', {'title': 'remember to email dave'})
</code></pre></div></div>

<p>Djangoì˜ <code class="language-plaintext highlighter-rouge">RequestFactory</code>ë¥¼ ì‚¬ìš©í•˜ë©´ ëª…ì‹œì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì§ì ‘ ì¸ì½”ë”©í•´ì•¼í•©ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.test.client import encode_multipart, RequestFactory

factory = RequestFactory()
data = {'title': 'remember to email dave'}
content = encode_multipart('BoUnDaRyStRiNg', data)
content_type = 'multipart/form-data; boundary=BoUnDaRyStRiNg'
request = factory.put('/notes/547/', content, content_type=content_type)
</code></pre></div></div>

<h4 id="forcing-authentication">Forcing authentication</h4>
<p><code class="language-plaintext highlighter-rouge">RequestFactory</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ë·°ë¥¼ í…ŒìŠ¤íŠ¸ í•  ë•ŒëŠ” ì¸ì¦ìê²© ì¦ëª…ì„ ì‘ì„±í•˜ì§€ì•Šê³  ì§ì ‘ ìê²©ìš”ì²­ì„ ì¸ì¦í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•©ë‹ˆë‹¤.</p>

<p>ê°•ì œ ìš”ì²­ì„ ì¸ì¦í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">force_authenticate()</code> ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from rest_framework.test import force_authenticate

factory = APIRequestFactory()
user = User.objects.get(username='olivia')
view = AccountDetail.as_view()

# Make an authenticated request to the view...
request = factory.get('/accounts/django-superstars/')
force_authenticate(request, user=user)
response = view(request)
</code></pre></div></div>

<p>ì´ ë©”ì†Œë“œì˜ ì„œëª…ì€ <code class="language-plaintext highlighter-rouge">force_authenticate(request, user = None, token = None)</code>ì…ë‹ˆë‹¤. ì „í™”ë¥¼ ê±¸ ë•Œ ì‚¬ìš©ìì™€ í† í° ì¤‘ í•˜ë‚˜ ë˜ëŠ” ë‘˜ ëª¨ë‘ê°€ ì„¤ì • ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì˜ˆë¥¼ ë“¤ì–´, í† í°ì„ ì‚¬ìš©í•˜ì—¬ ê°•ì œë¡œ ì¸ì¦í•˜ëŠ” ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user = User.objects.get(username='olivia')
request = factory.get('/accounts/django-superstars/')
force_authenticate(request, user=user, token=user.token)
</code></pre></div></div>

<hr />

<p><strong>Note</strong> : <code class="language-plaintext highlighter-rouge">APIRequestFactory</code>ë¥¼ ì‚¬ìš©í•  ë•Œ ë°˜í™˜ë˜ëŠ” ê°ì²´ëŠ” Djangoì˜ í‘œì¤€ <code class="language-plaintext highlighter-rouge">HttpRequest</code>ì´ë©°, REST í”„ë ˆì„ì›Œí¬ì˜ Request ê°ì²´ëŠ” ì•„ë‹ˆë©° ë·°ê°€ í˜¸ì¶œ ëœ í›„ì—ë§Œ â€‹â€‹ìƒì„±ë©ë‹ˆë‹¤.<br />
ì¦‰, request ê°ì²´ì— ì§ì ‘ ì†ì„±ì„ ì„¤ì •í•˜ë©´ í•­ìƒ ì›í•˜ëŠ” ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ì—†ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.<br />
ì˜ˆë¥¼ ë“¤ì–´, <code class="language-plaintext highlighter-rouge">.token</code>ì„ ì§ì ‘ ì„¤ì •í•´ë„ ì•„ë¬´ íš¨ê³¼ë„ ì—†ìœ¼ë©° ì„¸ì„  ì¸ì¦ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <code class="language-plaintext highlighter-rouge">.user</code>ë¥¼ ì§ì ‘ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Requestì€`SessionAuthentication`ì´ ì‚¬ìš© ì¤‘ì¼ ë•Œì— ë§Œ ì¸ì¦í•©ë‹ˆë‹¤.
request = factory.get('/accounts/django-superstars/')
request.user = user
response = view(request)
</code></pre></div></div>

<hr />

<h4 id="forcing-csrf-validation">Forcing CSRF validation</h4>
<p>ê¸°ë³¸ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">APIRequestFactory</code>ìœ¼ë¡œ ìƒì„± ëœ requestì—ëŠ” REST í”„ë ˆì„ì›Œí¬ ë·°ì— ì „ë‹¬ ë  ë•Œ CSRF ìœ íš¨ì„± ê²€ì‚¬ê°€ ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
CSRF ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ìˆ˜í–‰í•´ì•¼í•˜ëŠ” ê²½ìš°, íŒ©í† ë¦¬ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í•  ë•Œ <code class="language-plaintext highlighter-rouge">enforce_csrf_checks</code> í”Œë˜ê·¸ë¥¼ ì„¤ì •í•˜ë©´ë©ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>factory = APIRequestFactory(enforce_csrf_checks=True)
</code></pre></div></div>

<hr />

<p><strong>Note</strong> : Djangoì˜ í‘œì¤€ <code class="language-plaintext highlighter-rouge">RequestFactory</code>ëŠ” ì´ ì˜µì…˜ì„ í¬í•¨í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì‚¬ì‹¤ì— ì£¼ëª©í•´ì•¼ í•©ë‹ˆë‹¤. Djangoë¥¼ ì‚¬ìš©í•  ë•Œ ë·°ë¥¼ ì§ì ‘ í…ŒìŠ¤íŠ¸ í•  ë•Œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ë¯¸ë“¤ì›¨ì–´ì—ì„œ CSRF ìœ íš¨ì„± ê²€ì‚¬ê°€ ìˆ˜í–‰ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. REST í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•  ë•Œ ë·° ë‚´ë¶€ì—ì„œ CSRF ìœ íš¨ì„± ê²€ì‚¬ê°€ ìˆ˜í–‰ë˜ë¯€ë¡œ ìš”ì²­ íŒ©í† ë¦¬ëŠ” ë·° ìˆ˜ì¤€ì˜ CSRF ê²€ì‚¬ë¥¼ ë¹„í™œì„±í™”í•´ì•¼í•©ë‹ˆë‹¤.</p>

<hr />

<h3 id="apiclient">APIClient</h3>
<p>Djangoì˜ ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">Client</code>í´ë˜ìŠ¤ë¥¼ í™•ì¥í•©ë‹ˆë‹¤.</p>

<h4 id="making-requests">Making requests</h4>
<p><code class="language-plaintext highlighter-rouge">APIClient</code>í´ë˜ìŠ¤ëŠ” DJangoì˜ í‘œì¤€ Clientí´ë˜ìŠ¤ì™€ ë™ì¼í•œ ìš”ì²­ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ì¦‰, <code class="language-plaintext highlighter-rouge">.get()</code>, <code class="language-plaintext highlighter-rouge">.post()</code>, <code class="language-plaintext highlighter-rouge">.put()</code>, <code class="language-plaintext highlighter-rouge">.patch()</code>, <code class="language-plaintext highlighter-rouge">.delete()</code>, <code class="language-plaintext highlighter-rouge">.head()</code>, <code class="language-plaintext highlighter-rouge">.options()</code> ë©”ì„œë“œë¥¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from rest_framework.test import APIClient

client = APIClient()
client.post('/notes/', {'title': 'new idea'}, format='json')
</code></pre></div></div>
<p>ë” ë§Œì€ ì •ë³´ëŠ” <a href="http://www.django-rest-framework.org/api-guide/testing/#configuration">configuration section</a>ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.</p>

<h4 id="authenticating">Authenticating</h4>

<h5 id="loginkwargs">.login(**kwargs)</h5>
<p><code class="language-plaintext highlighter-rouge">login</code>ë©”ì†Œë“œëŠ” Djangoì˜ <code class="language-plaintext highlighter-rouge">Cilent</code>í´ë˜ìŠ¤ì™€ ë˜‘ê°™ì´ ì‘ë™í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ <code class="language-plaintext highlighter-rouge">SessionAuthentication</code>ì´ í¬í•¨ëœ ëª¨ë“  viewsì— ëŒ€í•œ ìš”ì²­ì„ ì¸ì¦ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Make all requests in the context of a logged in session.
client = APIClient()
client.login(username='lauren', password='secret')
</code></pre></div></div>
<p>ë¡œê·¸ì•„ì›ƒí•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">logout</code>ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì„¸ìš”.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Log out
client.logout()
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">login</code> ë©”ì†Œë“œëŠ” <code class="language-plaintext highlighter-rouge">AJAX API</code>ì™€ì˜ ìƒí˜¸ ì‘ìš©ì„ í¬í•¨í•˜ëŠ” ì›¹ ì‚¬ì´íŠ¸ì™€ ê°™ì´ ì„¸ì…˜ ì¸ì¦ì„ ì‚¬ìš©í•˜ëŠ” APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ”ë° ì í•©í•©ë‹ˆë‹¤.</p>

<h5 id="credentialskwargs">.credentials(**kwargs)</h5>
<p><code class="language-plaintext highlighter-rouge">credentials</code>ë©”ì†Œë“œëŠ” í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸ê°€ ëª¨ë“  í›„ì† ìš”ì²­ì— í¬í•¨ í•  í—¤ë”ë¥¼ ì„¤ì •í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from rest_framework.authtoken.models import Token
from rest_framework.test import APIClient

# Include an appropriate `Authorization:` header on all requests.
token = Token.objects.get(user__username='lauren')
client = APIClient()
client.credentials(HTTP_AUTHORIZATION='Token ' + token.key)
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">credentials</code>ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ë©´ ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">credentials</code>ì„ ë®ì–´ ì”ë‹ˆë‹¤. ì¸ìˆ˜ì—†ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ê¸°ì¡´ <code class="language-plaintext highlighter-rouge">credentials</code>ì˜ ì„¤ì •ì„ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Stop including any credentials
client.credentials()
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">credentials</code> ë°©ë²•ì€ ê¸°ë³¸ì¸ì¦, OAuth1aê³¼ OAuth2 ì¸ì¦ ë° ê°„ë‹¨í•œ í† í° ì¸ì¦ìŠ¤í‚¤ë§ˆì™€ ê°™ì€ ì¸ì¦ í—¤ë”ê°€ í•„ìš”í•œ APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ”ë° ì í•©í•©ë‹ˆë‹¤.</p>

<h5 id="force_authenticateusernone-tokennone">.force_authenticate(user=None, token=None)</h5>
<p>ë•Œë¡œëŠ” ì¸ì¦ì„ ìƒëµí•˜ê³  í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸ì˜ ëª¨ë“  ìš”ì²­ì„ ì¸ì¦ ëœ ê²ƒìœ¼ë¡œ ìë™ì²˜ë¦¬í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì´ëŠ” APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆì§€ë§Œ í…ŒìŠ¤íŠ¸ ìš”ì²­ì„ í•˜ê¸° ìœ„í•´ ìœ íš¨í•œ ìê²© ì¦ëª…ì„ ì‘ì„±í•˜ì§€ ì•Šìœ¼ë ¤ëŠ” ê²½ìš° ìœ ìš©í•œ ë‹¨ì¶•í‚¤ì…ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user = User.objects.get(username='lauren')
client = APIClient()
client.force_authenticate(user=user)
</code></pre></div></div>
<p>í›„ì† ìš”ì²­ì„ ì¸ì¦ í•´ì œí•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">force_authenticate</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©ì/í† í°ì„ <code class="language-plaintext highlighter-rouge">None</code>ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client.force_authenticate(user=None)
</code></pre></div></div>

<h4 id="csrf-validation">CSRF validation</h4>
<p>ê¸°ë³¸ì ìœ¼ë¡œ CSRF ìœ íš¨ì„± ê²€ì‚¬ëŠ” APICLientë¥¼ ì‚¬ìš©í•  ë–„ ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. CSRF ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í™œì„±í™”í•´ì•¼í•˜ëŠ” ê²½ìš° Clientë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í• ë•Œ <code class="language-plaintext highlighter-rouge">enforce_csrf_checks</code>í”Œë˜ê·¸ë¥¼ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client = APIClient(enforce_csrf_checks=True)
</code></pre></div></div>
<p>í‰ì†Œì²˜ëŸ¼ CSRF ìœ íš¨ì„±ê²€ì‚¬ëŠ” ì„¸ì…˜ ì¸ì¦ ëœ viewsì—ë§Œ ì ìš©ë©ë‹ˆë‹¤. ì¦‰, í´ë¼ì´ì–¸íŠ¸ê°€ <code class="language-plaintext highlighter-rouge">login()</code>ì„ í˜¸ì¶œí•˜ë ¤ ë¡œê·¸ì¸í•œ ê²½ìš°ì—ë§Œ CSRF ìœ íš¨ì„± ê²€ì‚¬ê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤.</p>

<hr />

<h3 id="requestsclient">RequestsClient</h3>
<p>RESR í”„ë ˆì„ì›Œí¬ì—ëŠ” <code class="language-plaintext highlighter-rouge">request</code>(Python ë¼ì´ë¸ŒëŸ¬ë¦¬)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ìƒí˜¸ ì‘ìš©í•˜ëŠ” clientë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš° ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ì£¼ë¡œ ë‹¤ë¥¸ Python ì„œë¹„ìŠ¤ì˜ APIì™€ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ëŒ€í•˜ê³  ìˆìœ¼ë©°, clientê°€ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒê³¼ ë™ì¼í•œ ìˆ˜ì¤€ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ í•  ë•Œ</li>
  <li>ì¤€ë¹„ ë˜ëŠ” ì‹¤ì œ í™˜ê²½ì— ëŒ€í•´ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ (â€œLive testâ€ ì°¸ì¡°)</li>
</ul>

<p>ì´ëŠ” requests ì„¸ì…˜ì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client = RequestsClient()
response = client.get('http://testserver/users/')
assert response.status_code == 200
</code></pre></div></div>
<p>requests clientì—ì„œëŠ” ì •ê·œí™” ëœ URLì„ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<h4 id="requestsclient-and-working-with-the-database"><code class="language-plaintext highlighter-rouge">RequestsClient</code> and working with the database</h4>
<p><code class="language-plaintext highlighter-rouge">RequestsClient</code>í´ë˜ìŠ¤ëŠ” ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ë§Œ ìƒí˜¸ ì‘ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë ¤ëŠ” ê²½ìš°ì— ìœ ìš©í•©ë‹ˆë‹¤. ì´ê²ƒì€ Django í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ì¡°ê¸ˆ ë” ì—„ê²©í•©ë‹ˆë‹¤. ëª¨ë“  ìƒí˜¸ì‘ìš©ì´ APIë¥¼ í†µí•´ ì´ë£¨ì–´ì ¸ì•¼í•˜ê¸° ë–„ë¬¸ì…ë‹ˆë‹¤.
<code class="language-plaintext highlighter-rouge">RequestsClient</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ê³¼ ì§ì ‘ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ëŒ€ì‹  í…ŒìŠ¤íŠ¸ ì„¤ì • ë° ê²°ê³¼ ì£¼ì¥(?)ì„ ì¼ë°˜ API í˜¸ì¶œë¡œ ìˆ˜í–‰í•´ì•¼í•©ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, <code class="language-plaintext highlighter-rouge">Customer.objects.count () == 3</code>ë¥¼ í™•ì¸í•˜ëŠ” ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">customers</code> ë§ˆì§€ë§‰ì ì„ ë‚˜ì—´í•˜ê³  3ê°œì˜ ë ˆì½”ë“œê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.</p>

<h4 id="headers--authentication">Headers &amp; Authentication</h4>
<p>custom í—¤ë”ì™€ ì¸ì¦ìê²© ì¦ëª…ì€ <code class="language-plaintext highlighter-rouge">requests.Session</code> ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•  ë•Œì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì œê³µ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from requests.auth import HTTPBasicAuth

client.auth = HTTPBasicAuth('user', 'pass')
client.headers.update({'x-test': 'true'})
</code></pre></div></div>

<h4 id="csrf">CSRF</h4>
<p><code class="language-plaintext highlighter-rouge">SessionAuthentication</code>ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <code class="language-plaintext highlighter-rouge">POST</code>, <code class="language-plaintext highlighter-rouge">PUT</code>, <code class="language-plaintext highlighter-rouge">PATCH</code>, <code class="language-plaintext highlighter-rouge">DELETE</code> ìš”ì²­ì— ëŒ€í•´ CSRF í† í°ì„ í¬í•¨í•´ì•¼í•©ë‹ˆë‹¤.
JavaScript ê¸°ë°˜ì˜ í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ íë¦„ìœ¼ë¡œ ìˆ˜í–‰ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
ë¨¼ì € CRSF í† í°ì„ ì–»ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">GET</code> ìš”ì²­ì„ í•˜ê³  ë‹¤ìŒ ìš”ì²­ì— í† í°ì„ ì œì‹œí•˜ì‹­ì‹œì˜¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client = RequestsClient()

# Obtain a CSRF token.
response = client.get('/homepage/')
assert response.status_code == 200
csrftoken = response.cookies['csrftoken']

# Interact with the API.
response = client.post('/organisations/', json={
    'name': 'MegaCorp',
    'status': 'active'
}, headers={'X-CSRFToken': csrftoken})
assert response.status_code == 200
</code></pre></div></div>
<h4 id="live-tests">Live tests</h4>
<p>ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•˜ë©´ <code class="language-plaintext highlighter-rouge">RequestsClient</code>ì™€ <code class="language-plaintext highlighter-rouge">CoreAPIClient</code>ê°€ ëª¨ë‘ ê°œë°œ í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ê±°ë‚˜ ì¤€ë¹„ ì„œë²„ ë˜ëŠ” í”„ë¡œë•ì…˜ í™˜ê²½ì— ì§ì ‘ ì‹¤í–‰ ë  ìˆ˜ ìˆëŠ” í…ŒìŠ¤íŠ¸ ì‚¬ë¡€ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ëŸ¼ ìŠ¤íƒ€ì¼ë¡œ ëª‡ ê°€ì§€ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ ì¼ë¶€ì— ëŒ€í•œ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“œëŠ” ê²ƒì€ ì‹¤ì œ ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•˜ëŠ” ê°•ë ¥í•œ ë°©ë²•ì…ë‹ˆë‹¤. ì´ë ‡ê²Œí•˜ë ¤ë©´ í…ŒìŠ¤íŠ¸ê°€ ê³ ê° ë°ì´í„°ì— ì§ì ‘ ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì • ë° í•´ì œí•˜ëŠ”ë° ì‹ ì¤‘ì„ ê¸°í•´ì•¼í•©ë‹ˆë‹¤.</p>

<hr />

<h3 id="coreapiclient">CoreAPIClient</h3>
<p><code class="language-plaintext highlighter-rouge">CoreAPIClient</code>ë¥¼ ì‚¬ìš©í•˜ë©´ <code class="language-plaintext highlighter-rouge">coreapi</code> (Python í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬)ë¥¼ ì‚¬ìš©í•˜ì—¬ APIì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Fetch the API schema
client = CoreAPIClient()
schema = client.get('http://testserver/schema/')

# Create a new organisation
params = {'name': 'MegaCorp', 'status': 'active'}
client.action(schema, ['organisations', 'create'], params)

# Ensure that the organisation exists in the listing
data = client.action(schema, ['organisations', 'list'])
assert(len(data) == 1)
assert(data == [{'name': 'MegaCorp', 'status': 'active'}])
</code></pre></div></div>

<h4 id="headers--authentication-1">Headers &amp; Authentication</h4>
<p>Customs í—¤ë”ì™€ ì¸ì¦ì€ <code class="language-plaintext highlighter-rouge">RequestsClient</code>ì™€ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">CoreAPIClient</code>ì™€ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from requests.auth import HTTPBasicAuth

client = CoreAPIClient()
client.session.auth = HTTPBasicAuth('user', 'pass')
client.session.headers.update({'x-test': 'true'})
</code></pre></div></div>

<hr />

<h3 id="test-cases">Test cases</h3>
<p>REST í”„ë ˆì„ì›Œí¬ëŠ” DJango í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í´ë˜ìŠ¤ë¥¼ ë°˜ì˜í•˜ì§€ë§Œ, Djangoì˜ ê¸°ë³¸ í´ë¼ì´ì–¸íŠ¸ ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">APIClient</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í´ë˜ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.</p>

<ul>
  <li>APISimpleTestCase</li>
  <li>APITransactionTestCase</li>
  <li>APITestCase</li>
  <li>APILiveServerTestCase</li>
</ul>

<h4 id="example">Example]</h4>
<p>Django í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ í´ë˜ìŠ¤ì²˜ëŸ¼ REST í”„ë ˆì„ì›Œí¬ì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í´ë˜ìŠ¤ ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">self.client</code> ì†ì„±ì€ <code class="language-plaintext highlighter-rouge">APIClient</code> ì¸ìŠ¤í„´ìŠ¤ì…ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.urls import reverse
from rest_framework import status
from rest_framework.test import APITestCase
from myproject.apps.core.models import Account

class AccountTests(APITestCase):
    def test_create_account(self):
        """
        Ensure we can create a new account object.
        """
        url = reverse('account-list')
        data = {'name': 'DabApps'}
        response = self.client.post(url, data, format='json')
        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        self.assertEqual(Account.objects.count(), 1)
        self.assertEqual(Account.objects.get().name, 'DabApps')
</code></pre></div></div>

<hr />

<h3 id="testing-responses">Testing responses</h3>

<h4 id="checking-the-response-data">Checking the response data</h4>
<p>í…ŒìŠ¤íŠ¸ ì‘ë‹µì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬ í•  ë•Œ ì™„ì „íˆ ë Œë”ë§ ëœ ì‘ë‹µì„ ê²€ì‚¬í•˜ëŠ” ê²ƒë³´ë‹¤ ì‘ë‹µì´ ìƒì„± ëœ ë°ì´í„°ë¥¼ ê²€ì‚¬í•˜ëŠ” ê²ƒì´ ë” í¸ë¦¬í•©ë‹ˆë‹¤.</p>

<p>ì˜ˆë¥¼ ë“¤ì–´, <code class="language-plaintext highlighter-rouge">response.data</code>ë¥¼ ê²€ì‚¬í•˜ëŠ” ê²ƒì´ ë” ì‰½ìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>response = self.client.get('/users/4/')
self.assertEqual(response.data, {'id': 4, 'username': 'lauren'})
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">response.content</code>ë¥¼ êµ¬ë¬¸ ë¶„ì„í•œ ê²°ê³¼ë¥¼ ê²€ì‚¬í•˜ëŠ” ëŒ€ì‹ :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>response = self.client.get('/users/4/')
self.assertEqual(json.loads(response.content), {'id': 4, 'username': 'lauren'})
</code></pre></div></div>

<h4 id="rendering-responses">Rendering responses</h4>
<p><code class="language-plaintext highlighter-rouge">APIRequestFactory</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ë·°ë¥¼ ì§ì ‘ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²½ìš°, í…œí”Œë¦¿ ì‘ë‹µì˜ ë Œë”ë§ì´ Djangoì˜ ë‚´ë¶€ requests - response ì— ì˜í•´ ìˆ˜í–‰ë˜ê¸° ë•Œë¬¸ì— ë°˜í™˜ë˜ëŠ” ì‘ë‹µì€ ì•„ì§ ë Œë”ë§ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">response.content</code>ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ ë¨¼ì € ì‘ë‹µì„ ë Œë”ë§í•´ì•¼í•©ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>view = UserDetail.as_view()
request = factory.get('/users/4')
response = view(request, pk='4')
response.render()  # Cannot access `response.content` without this.
self.assertEqual(response.content, '{"username": "lauren", "id": 4}')
</code></pre></div></div>

<hr />

<h3 id="configuration">Configuration</h3>

<h4 id="setting-the-default-format">Setting the default format</h4>
<p>í…ŒìŠ¤íŠ¸ ìš”ì²­ì„í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê¸°ë³¸ í˜•ì‹ì€ <code class="language-plaintext highlighter-rouge">TEST_REQUEST_DEFAULT_FORMAT</code> ì„¤ì • í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í…ŒìŠ¤íŠ¸ ìš”ì²­ì„ í•­ìƒ <code class="language-plaintext highlighter-rouge">JSON</code>ì„ ì‚¬ìš©í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">settings.py</code>íŒŒì¼ì—ì„œ ë‹¤ìŒì„ ì„¤ì •í•˜ì„¸ìš”.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REST_FRAMEWORK = {
    ...
    'TEST_REQUEST_DEFAULT_FORMAT': 'json'
}
</code></pre></div></div>

<h4 id="setting-the-available-formats">Setting the available formats</h4>
<p>multipart ë˜ëŠ” <code class="language-plaintext highlighter-rouge">json</code> ìš”ì²­ ì´ì™¸ì˜ ê²ƒì„ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ í…ŒìŠ¤íŠ¸í•´ì•¼í•˜ëŠ” ê²½ìš° <code class="language-plaintext highlighter-rouge">TEST_REQUEST_RENDERER_CLASSES</code> ì„¤ì •ì„ ì„¤ì •í•˜ì—¬ ìš”ì²­ì„ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì˜ˆë¥¼ ë“¤ì–´, í…ŒìŠ¤íŠ¸ ìš”ì²­ì— <code class="language-plaintext highlighter-rouge">format = 'html'</code>ì„ ì¶”ê°€í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">settings.py</code> íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì´ ì¶”ê°€í•©ë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REST_FRAMEWORK = {
    ...
    'TEST_REQUEST_RENDERER_CLASSES': (
        'rest_framework.renderers.MultiPartRenderer',
        'rest_framework.renderers.JSONRenderer',
        'rest_framework.renderers.TemplateHTMLRenderer'
    )
}
</code></pre></div></div>
:ET