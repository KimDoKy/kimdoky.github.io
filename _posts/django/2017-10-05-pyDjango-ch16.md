---
layout: post
section-type: post
title: pyDjango - chap16. 장고 핵심 기능 - Template
category: django
tags: [ 'django' ]
---
템플릿 문법은 그리 어려운 편이 아닙니다. 오히려 개발자가 작성한 템플릿 파일을 처리하는 내부 과정이 복잡한 편입니다. 장고 내부에서는 템플릿 엔진이 이런 템플릿의 복잡한 과정을 처리하고 있습니다.  

개발자가 스스로 정의하는 커스텀 템플릿 태그를 작성하고자 한다면 이런 템플릿의 내부 처리 과정을 이해할 필요가 있습니다.  

그리고 템플릿 파일을 코딩하는 경우에, 정적 파일을 다루는 경우가 많이 발생합니다. 정적 파일을 처리하는 staticfiles 애플리케이션에 대해서도 추가적으로 다룹니다.

## 16.1 템플릿 설정 항목
장고의 코어 템플릿 엔진을 DTL(Django Template Lauguage)이라고 합니다. 그리고 장고는 DTL 이외에도 Jinja 템플릿 엔징을 기본적으로 지원하고 있으며, 다른 템플릿 엔진도 설치하면 사용이 가능합니다.  

템플릿은 어떤 템플릿 엔진을 사용할 것인지 지정하는 것부터 시작합니다. 이느 설정 파일에서 이뤄지는데, 템플릿 엔진과 그 엔진에 적용할 옵션들을 지정합니다. 다음은 프로젝트 생성시 startproject 명령에 의해 작성된 settings.py 중에서 템플릿 설정 부분을 보여줍니다.

```python
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
```

**BACKEND** 항목은 사용할 템플릿 엔진을 지정합니다. 장고에서는 다음 2가지 템플릿 엔진을 기본적으로 지원하며, 필요하다면 장고의 템플릿 API를 이용해서 만든 서드 파티 엔진을 지정하는 것도 가능합니다.

- django.template.backends.django.DjangoTemplates : 장고의 자체 템플릿 엔진
- django.template.backends.jinja2.Jinja2 : 파이썬 언어의 대표적인 템플릿 엔진입니다. 시스템에 Jinja2 라이브러리만 설치되어 있으면, 장고가 제공하는 설정이나 API 등을 사용할 수 있습니다.

**DIRS** 항목은 프로젝트 템플릿 파일이 위치한 디렉터리를 지정합니다. 다음에 나오는 APP_DIRS 항목과 관련된 애플리케이션 템플릿 디렉터리보다 우선해 파일을 찾습니다. 디폴트는 빈 리스트입니다.

본문 예제에서는 다음처럼 프로젝트 디렉터리를 지정해 사용했습니다.

```python
'DIRS': [os.path.join(BASE_DIR, 'templates')],
```

**APP_DIRS** 항목은 템플릿 파일을 찾을 때, 애플리케이션 내의 템플릿 디렉터리에서도 찾을지 여부를 지정합니다. 디폴트는 False이지만 startproject 명령에 의해 settings.py 파일이 만들어 질때 True로 설정됩니다.  

**OPTIONS** 항목은 템플릿 엔진에 따라 해당하는 옵션 항목들을 설정합니다. 장고 템플릿 엔진을 사용하는 경우는 다음과 같은 옵션 항목이 있습니다.

- 'context_processors' : 웹 요청에 들어 있는 파라미터들(request)을 인자로 받아서 컨텍스트 데이터로 사용될 dict을 만들어주는 호출 가능한 객체(callable)를 지정합니다. 보통은 함수로 정의되는데, 이 함수들이 반환하는 dict는 최종 컨텍스트 데이터를 만들때  추가됩니다. 디폴트는 빈 리스트입니다.
- 'debug' : 템플릿 디버그 모드를 설정합니다. True로 설정하면, 템플릿 렌더링 과정에서 에러가 발생하면 템플릿 파일 내에서 에러가 발생한 줄을 다른 색으로 표시해줍니다. 디폴트는 다른 설정 항목인 DEBUG 항목의 값을 따릅니다.
- 'loaders' : 템플릿 로더 클래스를 지정합니다. 로더는 템플릿 파일을 찾아서 메모리로 로딩하는 역할을 수행합니다.
- 'string_if_invalid' : 템플릿 변수가 잘못된 경우, 대신 사용할 문자열을 지정합니다. 디폴트는 공백 문자열입니다.
- 'file_charset' : 템플릿 파일을 읽어 디코딩할 때 사용하는 문자셋을 지정합니다. 디폴트는 다른 설정 항목인 FILE_CHARSET 항목의 값을 따릅니다.

## 16.2 템플릿 내부 처리 과정
