---
layout: post
section-type: post
title: OAuth 2.0 - security
category: oauth
tags: [ 'oauth' ]
---

# OAuth 2.0 Security

### TLS를 사용

안전한 통신 채널을 사용한다. 서비스 제공자의 인가,토큰 엔드포인트가 https롤 시작하는지 확인한다.

TLS 이용은 선택사항이다. 필수로 TLS를 사용하면 구현이 복잡해지기 때문에 진입장벽이 높아지기 때문이다.

상용 애플리케이션의 경우 필수로 사용해야 한다.

### 최소한의 범위만을 요청

꼭 필요한 접근 권한만을 요청해야 한다.

### 암시적 그랜트 플로우를 사용할 때는 읽기 전용 권한만을 요청

비신뢰 클라이언트에 발급된 토큰은 본질적으로 안전하지 않다. 읽기 전용 권한만을 요청하면, 유출에 의한 피해를 최소한으로 할 수 있다.

### 사용자의 손이 미치지 않는 곳에 자격증명과 토큰을 보관

가장 좋은 방법은 백엔드 서버를 이용하는 것이다.

### 가능하면 항상 인가 코드 그랜트 플로우를 사용

백엔드 서버와 서비스 제공자의 통신은 사용자나 공격자가 볼 수 없게 숨길 수 있고, 완전히 추상화시킬 수 있다.

### 가능하면 항상 리프레시 토큰을 사용

액세스 토큰이 만료되면 인증 플로우를 다시 수해하지 않고 리프레시 토큰을 이용한다.  
보안적으로도 사용자가 인증을 다시 수행하는 횟수가 줄어들면, 공격자가 해당 정보를 탈취할 기회도 줄어들게 된다.

### 내장 브라우저 대신 네이티브 브라우저 이용

네이티브 브라우저는 서비스 제공자의 인가 엔드포인트가 유효한지, 인증서가 만료되었는지 등의 경고를 보여준다.  
내장 브라우저는 그렇지 않기 때문에 피싱 공격에 취약하다.  
네이티브 브라우저는 내장 브라우저의 세션을 공유하기 때문에 내장 브라우저의 쿠키를 사용할 수 있지만, 내장 브라우저는 반대로 사용이 불가하다.  
네이티브 브라우저는 비밀번호 관리자와 같은 플러그인을 사용할 수 있다.

### 리다이렉션 엔드포인트에서 서드파티 스크립트는 사용하지 않기

서드파티나 외부 스크립트는 리다이렉션 URI와 자격증명에 접근할 수 있다. 따라서 침해 스크립트가 있다면 공격자에게 액세스 토큰이나 인가 코드가 유출될 수 있다.  

서드파티 스크립트를 사용해야 한다면, URI에서 자격증명 정보를 추출해 제거하는 스크립트를 먼저 실행해야 한다.

### 클라이언트 자격증명을 바꿔서 사용

개인 비밀번호를 여러 개로 바꿔가면 사용하는 것처럼 클라이언트 자격증명도 그렇게 해야 한다. 정기적으로 바꿔서 사용한다면, 유출되었다 하더라도 유효시간이 제한되어 공격 벡터를 최소화할 수 있다.

### state 파라미터 사용

CSRF 공격은 사용자가 악의적인 링크를 방문하도록 유도하여 신뢰하는 사이트에서 사용자 모르게 원하지 않는 액션을 수행하는 공격 방법이다. 기존의 사용자와 사이트 간의 세션을 이용한다.

state 파라미터를 사용함으로써 공격자가 공격이 제대로 플로우가 진행되지 않는다.

### 리다이렉션 URI 등록

리다이렉션 URI를 등록하고, 와일드카드 문자는 되도록 사용하지 말아야 한다.

---

> 출처 및 참조  
[OAuth 2.0 마스터](http://book.interpark.com/product/BookDisplay.do?_method=detail&sc.prdNo=266585781)  
